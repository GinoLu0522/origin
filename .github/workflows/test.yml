name: Deploy MSIX on Merge to Master

on:
  push:
    branches:
      - master  # ç•¶ PR åˆä½µé€² masterï¼Œå°‡è§¸ç™¼éƒ¨ç½²æµç¨‹
    paths:
      - '**'    # ç›£æ§æ‰€æœ‰è·¯å¾‘è®Šæ›´

env:
  ARTIFACT_NAME: msix-package-x64  # å°æ‡‰ build å·¥ä½œä¸­ upload-artifact çš„åç¨±

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Download MSIX artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ env.ARTIFACT_NAME }}
          path: ./artifacts

      - name: Validate MSIX package
        run: |
          $package = Get-ChildItem -Path ./artifacts -Filter *.msix -Recurse | Select-Object -First 1
          if (-not $package) {
            Write-Output "::error::No MSIX package found in artifacts."
            exit 1
          }
          Write-Output "âœ… MSIX Package located at: $($package.FullName)"

      # å¯åœ¨æ­¤æ–°å¢éƒ¨ç½²æŒ‡ä»¤ï¼Œä¾‹å¦‚ä¸Šå‚³è‡³ä¼ºæœå™¨ã€Azure Blobã€æˆ– FTP
      # - name: Deploy to server
      #   run: |
      #     echo "Deploying $($package.FullName) ..."
      #     # å¯¦éš›éƒ¨ç½²æŒ‡ä»¤ï¼ˆFTP, WinRM, REST API ...ï¼‰

      - name: Done
        run: echo "ğŸ‰ Deployment process completed."
