name: Deploy MSIX on Merge to Master

on:
  push:
    branches:
      - master  # 當 PR 合併進 master，將觸發部署流程
    paths:
      - '**'    # 監控所有路徑變更

env:
  ARTIFACT_NAME: msix-package-x64  # 對應 build 工作中 upload-artifact 的名稱

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Download MSIX artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ env.ARTIFACT_NAME }}
          path: ./artifacts

      - name: Validate MSIX package
        run: |
          $package = Get-ChildItem -Path ./artifacts -Filter *.msix -Recurse | Select-Object -First 1
          if (-not $package) {
            Write-Output "::error::No MSIX package found in artifacts."
            exit 1
          }
          Write-Output "✅ MSIX Package located at: $($package.FullName)"

      # 可在此新增部署指令，例如上傳至伺服器、Azure Blob、或 FTP
      # - name: Deploy to server
      #   run: |
      #     echo "Deploying $($package.FullName) ..."
      #     # 實際部署指令（FTP, WinRM, REST API ...）

      - name: Done
        run: echo "🎉 Deployment process completed."
